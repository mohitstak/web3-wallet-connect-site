<script>
        document.addEventListener('DOMContentLoaded', () => {
            const connectWalletBtn = document.getElementById('connectWalletBtn');
            const walletAddressDiv = document.getElementById('walletAddress');
            const sendFundsBtn = document.getElementById('sendFundsBtn');
            const recipientAddressInput = document.getElementById('recipientAddress');
            const amountInput = document.getElementById('amount');
            const transactionResultDiv = document.getElementById('transactionResult');

            let connectedAccount = null;
            let provider = null;
            const usdtContractAddress = '0xC3C0d1Fb23d0D0cD037c1F755f3d669cE4A837Fa'; // USDT on BSC

            async function getUSDTBalance(address) {
                if (!provider || !address) return '0';
                try {
                    const tokenContract = new ethers.Contract(usdtContractAddress, [
                        'function balanceOf(address) view returns (uint256)',
                        'function decimals() view returns (uint8)'
                    ], provider);
                    const balanceRaw = await tokenContract.balanceOf(address);
                    const decimals = await tokenContract.decimals();
                    return ethers.utils.formatUnits(balanceRaw, decimals);
                } catch (error) {
                    console.error('Error fetching USDT balance:', error);
                    return '0';
                }
            }

            async function updateUSDTAmount() {
                if (connectedAccount) {
                    const balance = await getUSDTBalance(connectedAccount);
                    // Temporarily show the full balance
                    amountInput.value = balance;
                } else {
                    amountInput.value = '';
                }
            }

            // Call updateUSDTAmount on page load
            updateUSDTAmount();

            connectWalletBtn.addEventListener('click', async () => {
                if (typeof window.ethereum !== 'undefined') {
                    try {
                        const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                        if (accounts.length > 0) {
                            connectedAccount = accounts[0];
                            walletAddressDiv.textContent = `Connected Wallet: ${connectedAccount.substring(0, 6)}...${connectedAccount.slice(-4)}`;
                            connectWalletBtn.textContent = 'Wallet Connected';
                            sendFundsBtn.disabled = false;
                            provider = new ethers.providers.Web3Provider(window.ethereum);
                            console.log('Connected address:', connectedAccount);
                            // Update USDT amount after successful connection
                            updateUSDTAmount();
                        } else {
                            walletAddressDiv.textContent = 'No accounts found. Please connect your wallet.';
                            sendFundsBtn.disabled = true;
                            provider = null;
                            amountInput.value = '';
                        }
                    } catch (error) {
                        console.error('Error connecting to wallet:', error);
                        walletAddressDiv.textContent = `Error connecting: ${error.message}`;
                        sendFundsBtn.disabled = true;
                        provider = null;
                        amountInput.value = '';
                    }
                } else {
                    walletAddressDiv.textContent = 'Web3 provider not found. Please install MetaMask or a compatible wallet.';
                    sendFundsBtn.disabled = true;
                    provider = null;
                    amountInput.value = '';
                }
            });

            sendFundsBtn.addEventListener('click', async () => {
                // ... (rest of your sendFundsBtn event listener remains the same) ...
            });
        });
    </script>
